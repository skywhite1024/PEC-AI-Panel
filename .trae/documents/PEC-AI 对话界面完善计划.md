# PEC-AI 对话界面完善计划

## 1. 新增“分享”功能
- **位置**：AI回复内容下方的工具栏（已存在Share2图标）
- **实现**：
  - 添加分享按钮点击事件
  - 创建分享Modal组件，包含“复制链接”和“生成海报”选项
  - 实现复制链接功能，点击后显示Toast提示
  - 保持与现有按钮风格一致

## 2. 完善输入区功能
- **文件上传**：
  - 为Paperclip图标添加点击事件，触发隐藏的文件选择器
  - 实现文件选择后的预览Tag功能
  - 添加文件上传状态管理
- **语音输入**：
  - 为Mic图标添加点击事件，实现录音状态切换
  - 添加录音状态的视觉反馈（图标变色或闪烁）

## 3. 修复对话切换的状态丢失 Bug
- **核心问题**：activeModule状态未与对话关联，切换对话时重置
- **解决方案**：
  - 修改`ChatSession`接口，添加`activeModule`字段
  - 在`useChatHistory`中管理每个会话的`activeModule`状态
  - 在切换对话时恢复对应会话的`activeModule`
  - 在`activeModule`变化时更新当前会话的状态

## 实施顺序
1. 修复状态管理 Bug（核心逻辑）
2. 实现分享功能
3. 完善输入区功能
4. 测试所有功能

## 文件修改计划
- `hooks/useChatHistory.ts`：扩展`ChatSession`接口，添加`activeModule`字段
- `App.tsx`：
  - 实现分享Modal和功能
  - 完善输入区文件上传和语音输入功能
  - 修改对话切换逻辑，保存和恢复`activeModule`状态
- 新增：分享功能所需的CSS样式

## 预期效果
- 每个对话拥有独立的任务进度状态，切换对话时保持状态
- 分享功能正常工作，支持复制链接
- 输入区支持文件上传和语音输入，UI协调美观